# E2E Test: Portfolio Screen
#
# terminal command to run: maestro test .maestro/portfolio.yaml
#
# Objetivo:
#   Verificar que el módulo de Portfolio funciona correctamente
#   incluyendo carga de datos, visualización de posiciones,
#   cálculos de ganancias/pérdidas y navegación
#
# Casos cubiertos:
#   - Navegación al tab Portfolio
#   - Screen de portfolio se carga
#   - Valor total del portafolio se muestra
#   - Lista de posiciones se muestra
#   - Datos de posiciones se muestran correctamente (ticker, cantidad, precios, ganancia)
#   - Pull-to-refresh funciona
#   - Verificación de múltiples posiciones
#   - Verificación de elementos individuales de position cards
#   - Cálculos de profit/loss

appId: host.exp.exponent
---

# =============================================================================
# 1. NAVEGACIÓN AL TAB PORTFOLIO
# =============================================================================

# Esperar a que la app se inicialice
- waitForAnimationToEnd:
    timeout: 3000

# Tap en el tab de Portfolio (segundo tab en la navegación inferior)
- tapOn:
    text: "Portfolio"

# Esperar a que la animación de navegación termine
- waitForAnimationToEnd:
    timeout: 1000

# =============================================================================
# 2. VERIFICAR CARGA INICIAL DEL SCREEN
# =============================================================================

# Verificar que el screen de portfolio está visible
- assertVisible:
    id: "portfolio-screen"

# Esperar a que carguen los datos de la API
- waitForAnimationToEnd:
    timeout: 5000

# =============================================================================
# 3. VERIFICAR RESUMEN DEL PORTFOLIO (VALOR TOTAL)
# =============================================================================

# Verificar que el card de resumen está visible
- assertVisible:
    id: "portfolio-summary"

# Verificar que el valor total se muestra
- assertVisible:
    id: "portfolio-total-value"

# =============================================================================
# 4. VERIFICAR LISTA DE POSICIONES
# =============================================================================

# Verificar que la lista de posiciones está presente
- assertVisible:
    id: "position-list"

# Verificar que al menos una posición se cargó
# Usamos regex para verificar cualquier ticker dinámico
- assertVisible:
    id: "position-card-.*"

# Verificar que múltiples posiciones están visibles
# Al menos 2 posiciones deberían estar si el portfolio tiene datos
- assertVisible:
    id: "position-card-.*"
    index: 0

- assertVisible:
    id: "position-card-.*"
    index: 1
    optional: true

# =============================================================================
# 5. VERIFICAR ESTRUCTURA DE UN POSITION CARD
# =============================================================================

# Verificar todos los elementos de la primera posición

# Ticker de la posición
- assertVisible:
    id: "position-card-ticker"
    index: 0

# Cantidad de acciones
- assertVisible:
    id: "position-card-quantity"
    index: 0

# Valor de mercado
- assertVisible:
    id: "position-card-market-value"
    index: 0

# Porcentaje de ganancia/pérdida
- assertVisible:
    id: "position-card-profit-percentage"
    index: 0

# Ganancia/pérdida en monto
- assertVisible:
    id: "position-card-profit"
    index: 0

# =============================================================================
# 6. VERIFICAR SCROLL (SI HAY MÚLTIPLES POSICIONES)
# =============================================================================

# Scroll hacia abajo para ver más posiciones si existen
- scroll:
    optional: true

# Verificar que hay más posiciones después del scroll (si las hay)
- assertVisible:
    id: "position-card-.*"
    index: 2
    optional: true

# =============================================================================
# 7. VERIFICAR PULL-TO-REFRESH
# =============================================================================

# Scroll hacia arriba antes del pull-to-refresh
- swipe:
    start: 50%, 80%
    end: 50%, 20%

- waitForAnimationToEnd:
    timeout: 500

# Hacer pull-to-refresh (swipe down desde arriba)
- swipe:
    start: 50%, 30%
    end: 50%, 80%

- waitForAnimationToEnd:
    timeout: 3000

# Verificar que el screen todavía está visible después del refresh
- assertVisible:
    id: "portfolio-screen"

# Verificar que el resumen todavía está visible
- assertVisible:
    id: "portfolio-summary"

# Verificar que la lista todavía está visible
- assertVisible:
    id: "position-list"

# Verificar que las posiciones todavía están ahí
- assertVisible:
    id: "position-card-.*"
    index: 0

# =============================================================================
# 8. VERIFICAR ESTADO VACÍO (OPCIONAL)
# =============================================================================

# Nota: Esta sección solo aplica si el portfolio está vacío
# Verificar el estado vacío del portfolio
- assertVisible:
    id: "portfolio-empty-state"
    optional: true

# =============================================================================
# 9. VERIFICACIÓN FINAL
# =============================================================================

# Verificar que el portfolio screen todavía está funcional
- assertVisible:
    id: "portfolio-screen"

# Verificar que la lista está presente
- assertVisible:
    id: "position-list"

# Test completado exitosamente
